# Installation Quickstart

`legno` and all of its associated tools are written in python. Please ensure you have python3 installed.

On OSX (brew required):

    brew install python3
  
On Windows (choco required):

    choco install python3
  
Once you have python3 installed, install the following packages:

  pip3 install gpkit more-itertools matplotlib scikit-learn scipy numpy pyserial networkx construct

## Testing your setup

To test your setup, first generate a collection of test programs with `apep.py`. The `apep.py` script 
generates parameter sweep experiments for all the analog blocks. The generated experiments are dumped into the 
`calibrate` and `transforms` directories.

     python3 apep.py
  
Open one of the Arduino projects in the newly created `transforms/` directory. All of the projects in this directory
perform a parameter sweep on one of the DACs, and then observes the DUE ADC values for both the positive and negative analog
signals. All of the projects have the following structure:

     `<proj_name>.ino` : contains the experiment runner. This file performs the calibration necessary for all the experiment then 
     runs multiple trials of each experiment. Each experiment consists of the configuration to write to the board, and an procedure
     that determines what to do with the configured hardware.
     
     `<configuration_name>.h`: contains all the utility function definitions. This includes circuit setup/teardown, supplying inputs \
     to the configuration and recording values.
     
     `<configuration_name>.cpp`: contains the implementation of all the utility function definitions.
     

Program one of these projects onto the DUE Arduino board. I recommend using the NativeUSB port since all the debugging messages 
are generated over SerialUSB. If you're determined to run the project over the programming port, bug me and i'll add a flag to
write the debugging messages over Serial.

#### Running the Experiment

Once the chip is programmed, execute `scripts/save_data.py`. The `save_data.py` script initiates the experiment runner on the Arduino's side and
records all the debugging/experiment output to an output file (`output_file.txt` in the example below). You will be prompted to press <enter> to start the experiment \
(the chip is programmed to wait for you):

     python3 scripts/save_data.py output_file.txt
     
Wait for the experiment to finish running. The `save_data.py` script will automatically close when the experiments are done running.

#### Saving the data

Once the experiment is finished, you can save all the experiment data to individual datafiles with the `read_data.py`. The `read_data.py` script 
parses the output file generated by `save_data.py` and extracts the data for each experiment from it. Each dataset is saved to 
`outdir/expname_expparams_trial.json`, where `outdir` is the directory to output the files to:

     python3 scripts/read_data.py output_file.txt out_dir

_Note_: there's a bug in this script with some data patterns. I'll fix it soon.

#### Visualizing the data

You can visualize the saved datasets using the `visualize.py` script. The `visualize.py` script may be run in `batch` or `single` mode. Batch
mode processes all the data files in a directory, whil single mode processes only one data file. The visualizations are saved as `.png` files
in the same directory as the dataset, with the same name as the dataset.

    python3 scripts/visualize.py out_dir
    

     
   



